# 一致性哈希（Consistent Hash）

## 设计目标

其设计目标是在对等分布式系统中，在分布式哈希过程中，让节点数量对于分布式哈希表的映射的改变降到最低。

## 常见问题

### 什么是一致性哈希，他的应用场景是什么？

**一致性哈希**： 一致性哈希是一种特殊的哈希技术，当哈希表大小被调整时，平均只有n/m个key需要重新映射哈希槽位。（其中，n是key的个数，m是槽位个数）

**应用场景**：主要运用在对等网络的分布式系统中，比如集群模式下的Redis系统。

### 一致性哈希的基本工作原理是怎么样的？

现在有一个环，有2^32-1个点均匀分布在环上，这个环被称为哈希环。

当一个集群启动时候，首先将机器通过哈希算法散列到这个这个环上的某个点。当一个请求到来时候，对这个请求做哈希，请求会被路由到比这个哈希值大的下一个机器上。

当机器数量变化时候有如下操作：

1. 增加一台机器，哈希槽位在前一台机器之后，此台新机器之前的数据需要转移到此台机器。
2. 减少一台机器，此机器之前，上一台机器之后的数据需要转移到下一台机器上。

### 一致性哈希有什么缺陷？如何解决？

1. 特别是当节点数量少时候，可能发生非常严重的数据倾斜问题。
    - 使用**虚拟节点机制**，即在哈希环中虚拟出N个节点，这些节点的实际负载分配给物理节点处理，来保证均衡。

### Redis的Cluster模式下是如何实现负载均衡的？

Redis的集群模式没有采用一致性哈希算法。 采用了哈希槽（Hash Slot）来保证的，每个Redis集群中共有16383个哈希槽，然后集群中的服务器均分哈希槽位。






